if { $::argc ne 4} {
  puts "USAGE $::argv0 target packets delay cycles"
  return 1
}
set dst [lindex $argv 0]
set n [lindex $argv 1]
set delay [lindex $argv 2]
set cycles [lindex $argv 3]
set packet "ip(daddr=$dst,tos=0,ttl=64)+udp(sport=49152,dport=4791)+data(hex=00)"
set messages {
 "0640000000000123000000000000000000000000000000000000800000000000000000000000"
 "0740000000000123000000000000000000000000000000000000800000000000000000000000"
 "0740000000000123000000000000000000000000000000000000800000000000000000000000"
 "0740000000000123000000000000000000000000000000000000800000000000000000000000"
 "0740000000000123000000000000000000000000000000000000800000000000000000000000"
 "1140000000000123000000000700000000000000000000000000000000000000000000000000"
 "8100000000000123000000000000000000000000000000000000000000000000000000000000"
}
for {set c 0} {$c < $cycles} {incr c} {
  set p 0
  while {$p < $n} {
    foreach message $messages {
      if {rand()<0.1} {set tos 3} else {set tos 0}
      set packet [hping setfield data hex $message $packet]
      set packet [hping setfield ip tos $tos $packet]
      hping send $packet
      incr p
    }
  }
  after $delay
}

